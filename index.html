<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Backyard Ultra Terrassa</title>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        background-color: #121212;
        color: #ffffff;
        font-family: Arial, sans-serif;
        text-align: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
      }

      h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      p {
        font-size: 1.25rem;
        margin: 10px 0;
      }

      .emoji-art {
        font-size: 2rem;
        margin-top: 20px;
      }

      .logo-container {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 30px;
        width: 100%;
        max-width: 600px;
      }

      .logo-container img {
        width: 100%;
        max-width: 300px;
        height: auto;
      }

      @media (max-width: 480px) {
        h1 {
          font-size: 1.8rem;
        }

        p {
          font-size: 1rem;
        }

        .emoji-art {
          font-size: 1.5rem;
        }

        .logo-container img {
          max-width: 80%;
        }
      }

      /* Preregistration form styles */
      .card {
        background: #1e1e1e;
        border: 1px solid #2a2a2a;
        border-radius: 12px;
        padding: 20px;
        margin-top: 24px;
        width: 100%;
        max-width: 560px;
        text-align: left;
      }
      .card h2 {
        margin: 0 0 8px 0;
        font-size: 1.4rem;
      }
      .subtle {
        color: #cfcfcf;
        font-size: 0.95rem;
        margin: 0 0 12px 0;
      }
      .row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }
      .field {
        display: flex;
        flex-direction: column;
        flex: 1;
        min-width: 200px;
        margin-bottom: 12px;
      }
      label {
        font-size: 0.95rem;
        margin-bottom: 6px;
      }
      input[type="text"],
      input[type="email"] {
        background: #121212;
        color: #fff;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 10px 12px;
        font-size: 1rem;
        outline: none;
      }
      input[type="text"]:focus,
      input[type="email"]:focus {
        border-color: #555;
      }
      .checkbox {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin: 8px 0 12px 0;
      }
      .checkbox input {
        margin-top: 3px;
      }
      .actions {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      button[type="submit"] {
        background: #4caf50;
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 10px 16px;
        font-size: 1rem;
        cursor: pointer;
      }
      button[disabled] {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .error {
        color: #ff6b6b;
        font-size: 0.95rem;
      }
      .success {
        color: #7cd992;
        font-size: 1rem;
      }
      /* Tooltip */
      .info { display: inline-flex; align-items: center; gap: 8px; }
      .info-icon {
        display: inline-block;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        border: 1px solid #aaa;
        color: #ddd;
        font-weight: 700;
        font-size: 0.85rem;
        line-height: 16px;
        text-align: center;
        cursor: default;
        position: relative;
      }
      .tooltip {
        visibility: hidden;
        opacity: 0;
        position: absolute;
        top: 22px;
        left: 50%;
        transform: translateX(-50%);
        background: #222;
        color: #eee;
        border: 1px solid #333;
        padding: 10px 12px;
        border-radius: 8px;
        width: 280px;
        font-size: 0.9rem;
        line-height: 1.3;
        transition: opacity 0.15s ease-in-out;
        z-index: 10;
        text-align: left;
      }
      .tooltip::after {
        content: "";
        position: absolute;
        top: -6px;
        left: 50%;
        transform: translateX(-50%);
        border-left: 6px solid transparent;
        border-right: 6px solid transparent;
        border-bottom: 6px solid #333;
      }
      .info-icon:hover .tooltip,
      .info-icon:focus .tooltip {
        visibility: visible;
        opacity: 1;
      }
    </style>
  </head>
  <body>
        <div class="logo-container">
      <a
        href="https://www.instagram.com/backyardultraterrassa/"
        target="_blank"
      >
        <img src="logodarkmode.png" alt="Backyard Ultra Terrassa Logo" />
      </a>
    </div>
    <h1>üèÉ‚Äç‚ôÇÔ∏è Backyard Ultra Terrassa üèÉ‚Äç‚ôÄÔ∏è</h1>
    <p id="status-text">üöß Work in Progress... Stay tuned! üöß</p>
    <p id="std-text">Save the date üìÖ - 14 March 2026</p>

    <div id="prereg-card" class="card" role="region" aria-labelledby="prereg-title">
      <div class="info" style="justify-content: space-between; align-items: start;">
        <h2 id="prereg-title">Preregister for BYUT 2026</h2>
        <span class="info-icon" tabindex="0" aria-label="Info">
          i
          <span class="tooltip" role="tooltip">
            Preregistration does not guarantee entry. Everyone who preregisters will
            receive a personal email invitation to register before general
            registration opens. Personal data is kept only for preregistration and
            email reminders, and will be deleted when official registration opens
            after reminder emails are sent.
          </span>
        </span>
      </div>
      <p class="subtle">Please complete all fields and accept the data policy.</p>

      <form id="prereg-form" novalidate>
        <div class="row">
          <div class="field">
            <label for="firstName">Name</label>
            <input id="firstName" name="firstName" type="text" autocomplete="given-name" required />
          </div>
          <div class="field">
            <label for="lastName">Last Name</label>
            <input id="lastName" name="lastName" type="text" autocomplete="family-name" required />
          </div>
        </div>
        <div class="field">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" inputmode="email" autocomplete="email" required />
        </div>

        <div class="checkbox">
          <input id="consent" name="consent" type="checkbox" required />
          <label for="consent">
            I grant permission to store my personal data in accordance with applicable laws in Spain, solely for preregistration and reminder purposes. Data will be deleted when official registration opens after reminder emails are sent.
          </label>
        </div>

        <div id="form-error" class="error" role="alert" aria-live="polite" style="display:none;"></div>

        <div class="actions">
          <button id="submit-btn" type="submit">Preregister</button>
          <span id="submit-status" class="subtle" aria-live="polite"></span>
        </div>
      </form>
    </div>

    <div id="prereg-success" class="card" style="display:none;">
      <h2>You're on the list üéâ</h2>
      <p class="success">Thank you for preregistering. We‚Äôll email you a personal invitation before general registration opens.</p>
    </div>

    <script>
      const texts = [
        "üöß En proc√©s... Estigueu atents! üöß",
        "üöß En progreso... ¬°Estad atentos! üöß",
        "üöß Work in Progress... Stay tuned! üöß",
      ];
      const texts2 = ["Guarda't la data üìÖ - 14 Mar√ß 2026","Guardate la fecha üìÖ - 14 Marzo 2026","Save the date üìÖ - 14 March 2026"]
      let index = 0;
      function changeLanguage() {
        index = (index + 1) % texts.length;
        document.getElementById("status-text").innerText = texts[index];
        document.getElementById("std-text").innerText = texts2[index];
      }
      setInterval(changeLanguage, 5000);

      // ===== Preregistration form logic =====
      // Replace this with your deployed Google Apps Script Web App URL.
      // See the instructions in my message to set it up.
      const GOOGLE_APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwZ-JhiOcTNMJHmIlE8Px1VKaAXbfCiru8gnNIfgTOebIZlsDIQWnvSE9bu4nurOe9AIw/exec"; // e.g. https://script.google.com/macros/s/AKfycbx.../exec

      const form = document.getElementById('prereg-form');
      const submitBtn = document.getElementById('submit-btn');
      const errorBox = document.getElementById('form-error');
      const statusText = document.getElementById('submit-status');
      const successCard = document.getElementById('prereg-success');
      const preregCard = document.getElementById('prereg-card');

      const STORAGE_KEY = 'byut_preregistered_email';

      function showError(msg) {
        if (!errorBox) return;
        errorBox.style.display = 'block';
        errorBox.textContent = msg;
      }
      function clearError() {
        if (!errorBox) return;
        errorBox.style.display = 'none';
        errorBox.textContent = '';
      }
      function isValidEmail(email) {
        // Simple robust email validation pattern
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
        return re.test(String(email).trim());
      }
      function setSubmitting(submitting) {
        if (submitBtn) submitBtn.disabled = submitting;
        if (statusText) statusText.textContent = submitting ? 'Submitting‚Ä¶' : '';
      }
      function showSuccess(email) {
        if (preregCard) preregCard.style.display = 'none';
        if (successCard) successCard.style.display = 'block';
        if (email) {
          try { localStorage.setItem(STORAGE_KEY, String(email)); } catch (_) {}
        }
      }

      // If already preregistered on this browser, show success
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          showSuccess(saved);
        }
      } catch (_) {}

      form?.addEventListener('submit', async (e) => {
        e.preventDefault();
        clearError();

        const firstName = document.getElementById('firstName')?.value?.trim() || '';
        const lastName = document.getElementById('lastName')?.value?.trim() || '';
        const email = document.getElementById('email')?.value?.trim() || '';
        const consent = Boolean(document.getElementById('consent')?.checked);

        if (!firstName || !lastName || !email) {
          showError('Please complete all fields.');
          return;
        }
        if (!isValidEmail(email)) {
          showError('Please enter a valid email address.');
          return;
        }
        if (!consent) {
          showError('You must grant permission to store your data.');
          return;
        }
        if (!GOOGLE_APPS_SCRIPT_URL) {
          showError('Submission endpoint is not configured yet.');
          return;
        }

        setSubmitting(true);
        try {
          const resp = await fetch(GOOGLE_APPS_SCRIPT_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ firstName, lastName, email })
          });
          if (!resp.ok) {
            throw new Error(`Request failed: ${resp.status}`);
          }
          const data = await resp.json().catch(() => ({}));
          if (data && (data.success === true || data.status === 'ok')) {
            showSuccess(email);
          } else {
            // Accept success if endpoint returns 200 without JSON contract
            showSuccess(email);
          }
        } catch (err) {
          console.error(err);
          showError('There was a problem submitting your preregistration. Please try again later.');
        } finally {
          setSubmitting(false);
        }
      });
    </script>
  </body>
</html>
